---
title: "antibioticos"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(ggplot2)
library(plyr)
library( reshape )
library(data.table)
library(easyGgplot2)

library(dplyr)
```

## Presence of antibiotic genes in BGCs 


Methodology
Families of CARD
Homology search was conducted using blast (e-vaule )all vs all were Antibiotic resistance genes from The Comprehensive Antibiotic Resistance Database (CARD) where blasted all vs all 
FastOrtho 

Homology searches between CARD and MIBiG 
blast CARD vs MiBIG
blast MiBiG bs CARD

¿How many BGCs contain an AR gene?
¿How many families of AR genes are present in BGC?
Which families are over represented
How many BGCs per AR gene/Family



# Protein families in CARD  
The following figure shows the most populated families in CARD database.
```{r FO_families_CARD}
CAARD_file="CARD.FO.families"
CARDFamiliesTable <- read_delim(CAARD_file, "\t", escape_double = FALSE, col_names = FALSE, trim_ws = TRUE)
colnames(CARDFamiliesTable)=c("Gen_ID_CARD","secondary_ID_CARD","FO_Family")
head(CARDFamiliesTable)
#Gen_Id, Familia (según fastOrtho)
#Cada renglón es una ocurrencia de un gen de la familia 
CARDFamiliesTable$FO_Family

sortCARD<-CARDFamiliesTable %>% group_by(FO_Family) %>% mutate(n=n())%>% ungroup() %>% arrange(-n)
First_10<-sortCARD[1:784,]
tail(First_10)
ggplot(First_10, aes(FO_Family))+ geom_histogram(stat="count")+ theme(plot.title=element_text(size=20, 
                                    face="bold", 
                                    family="American Typewriter",
                                    color="tomato",
                                    lineheight=1.2),  # title
            axis.title.y=element_text(size=15),  # Y axis title
            axis.text.x=element_text(size=10, 
                                     angle = 30,
                                     vjust=.5),  # X axis text
            axis.text.y=element_text(size=10))  # Y axis text
```
These first five families, in a preliminar search corresponds to:
|  Family	| Annotation  	|
|---	|---	|
| Family 0 	|  	|
| Family 1  	|  	|
| Family 2	|  	|
| Family 3 	|  	|
| Family 4 	|  	|


# BGC clases in MiBIG  
The following figure shows the most populated classes in MiBIG database.

```{r MiBIG}
MIBiG_file="MiBIG_DB.faa.meta"
MIBiGTable <- read_delim(MIBiG_file, "\t", escape_double = FALSE, col_names = FALSE, trim_ws = TRUE)
#Gen_Id, Familia (según fastOrtho)
#Cada renglón es una ocurrencia de un gen de la familia 1
colnames(MIBiGTable)=c("BGC_ID","compound","clase","source","phylum","kingdom","completness")
head(MIBiGTable)

sortMIBiG<-MIBiGTable %>% group_by(clase) %>% mutate(n=n())%>% ungroup() %>% arrange(-n)
#First_10_MIBiG<-sortMIBiG[1:784,]
#head(First_10_MIBiG)
ggplot(sortMIBiG, aes(clase))+ geom_histogram(stat="count")+ theme(plot.title=element_text(size=20, 
                                    face="bold", 
                                    family="American Typewriter",
                                    color="tomato",
                                    lineheight=1.2),  # title
            axis.title.y=element_text(size=15),  # Y axis title
            axis.text.x=element_text(size=10, 
                                     angle = 90,
                                     vjust=.5),  # X axis text
            axis.text.y=element_text(size=10))  # Y axis text


```

# Interaction CARD - MiBIG  
The following figure shows which CARD families are the most  populated classes in MiBIG database.

```{r CAARD_vs_MiBIG }
CARD_vs_MIBiG_file="CARDquery.blast1"
CARD_vs_MIBiGTable <- read_delim(CARD_vs_MIBiG_file, "\t", escape_double = FALSE, col_names = FALSE, trim_ws = TRUE)
#Cada renglón es una ocurrencia de un gen de la familia 1
colnames(CARD_vs_MIBiGTable)=c("Gen_ID_CARD","CARD_SOURCE","BGC_ID","MIBIG_annotation","MIBIG_gen_Id")
head(CARD_vs_MIBiGTable)

#CARDFamiliesTable$FO_Family[CARDFamiliesTable$Gen_ID_CARD %in% c("ACT97415.1")]

#CARDFamiliesTable$FO_Family[CARDFamiliesTable$Gen_ID_CARD %in% c(CARDFamiliesTable$Gen_ID_CARD)]
#CARDFamiliesTable$Gen_ID_CARD %in% c("ACT97415.1")

CARD_vs_MIBiGTable$CARD_FO<-CARDFamiliesTable$FO_Family[CARD_vs_MIBiGTable$Gen_ID_CARD %in% c(CARDFamiliesTable$Gen_ID_CARD)]


```

which CAARD families are over represented in MiBiG
which MiBiG classes are over represented as CARD hits